{"version":3,"file":"static/chunks/pages/packet-log-13c808691c5b072a.js","mappings":"qFACKA,OAAOC,SAAWD,OAAOC,UAAY,IAAIC,KAAK,CAC7C,cACA,WACE,OAAO,EAAQ,U,4ECOE,E,muCAAzB,IAAMC,GAOL,EAPwB,EAOxB,GANIC,EAAAA,WAAAA,KAAkB,QAAM,EADJ,EAEpBA,EAAAA,WAAAA,MAAmB,QAAM,EAFL,EAGpBA,EAAAA,WAAAA,QAAqB,QAAM,EAHP,EAIpBA,EAAAA,WAAAA,GAAgB,QAAM,EAJF,EAKpBA,EAAAA,WAAAA,KAAkB,QAAM,EALJ,EAMpBA,EAAAA,WAAAA,MAAmB,QANC,GAenBC,EAAQ,IAAI,W,uCAadC,oBAA4CC,GAGxCC,EAAAA,EAAAA,IACIC,KACA,CACIH,eAAgBI,EAAAA,GAAAA,OAIxBC,EAAAA,EAAAA,KAAQ,WAC4B,IAA5BC,EAAAA,EAAAA,KAAAA,S,EACKN,oBAAiBC,M,0BAxB9BM,IAAAA,kB,IAAJ,WACI,MAAO,CACH,CACIC,IAAK,QACLC,UAAWH,EAAAA,EAAAA,OACXI,UAAW,CAAEC,SAAUC,EAAAA,GAAAA,QACvBC,KAAM,QACNC,QAAS,W,OAAMR,EAAAA,EAAAA,mB,6BARd,IA+BXS,GAAaC,EAAAA,EAAAA,GAAW,CAC1BC,KAAM,CACFC,OAAQ,GAEZC,KAAM,CACFD,OAAQ,QAEZE,OAAQ,CACJC,UAAW,SACXC,WAAa,GAAc,OA1Cf,GA0Ce,OAE/BC,IAAK,CACD,UAAW,CACPC,gBAAiB,YAGzBC,SAAU,CACND,gBAAiB,WAErBE,KAAM,EAAF,CACAC,WAAY,YACZC,aAAc,WACdC,WAAY,SACZP,WAAYQ,OACZC,OAAQ,WACLC,EAAAA,GAAAA,SAAoB,WAE3BC,UAAW,EAAF,GACFD,EAAAA,GAAAA,QAAmB,QACnBA,EAAAA,GAAAA,UAAqB,MAAO,QAAS,yBAI1CE,EAAoB,CACtB,CACIC,MAAO,YACPC,MAAO,IACPC,eAAeC,EAAAA,EAAAA,IAAgB,YAAhBA,EAA6B,SAAQ,G,IAALC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaC,EAAI,KAA5BF,YAAWC,aAChDE,EAAOpC,EAAAA,EAAAA,KAAiBkC,GAExBG,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQjB,OACvCe,EAAI,C,SAEPC,EAAKI,iBAKtB,CACIX,MAAO,UACPC,MAAO,IACPC,eAAeC,EAAAA,EAAAA,IAAgB,UAAhBA,EAA2B,SAAQ,G,IAKtCzC,EALiC0C,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaC,EAAI,KAA5BF,YAAWC,aAC9CE,EAAOpC,EAAAA,EAAAA,KAAiBkC,GAEzBE,EAAKK,gBACNL,EAAKK,cAC4B,QAA7BlD,EAAAA,EAAiB6C,EAAKM,gBAAsB,IAA5CnD,EAAAA,GACAoD,EAAAA,EAAAA,YAAW,IAAIC,YAAY,CAACR,EAAKM,YAGzC,IAAML,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQjB,OACvCe,EAAI,C,SAEPC,EAAKK,qBAKtB,CACIZ,MAAO,OACPC,MAAO,IACPC,eAAeC,EAAAA,EAAAA,IAAgB,UAAhBA,EAA2B,SAAQ,G,IAALC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaC,EAAI,KAA5BF,YAAWC,aAC9CE,EAAOpC,EAAAA,EAAAA,KAAiBkC,GAEzBE,EAAKS,aACNT,EAAKS,WAAaT,EAAKU,KAAKC,SAAS,IAAIC,SAAS,EAAG,MAGzD,IAAMX,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQjB,OACvCe,EAAI,C,SAEPC,EAAKS,kBAKtB,CACIhB,MAAO,OACPC,MAAO,IACPC,eAAeC,EAAAA,EAAAA,IAAgB,UAAhBA,EAA2B,SAAQ,G,IAALC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaC,EAAI,KAA5BF,YAAWC,aAC9CE,EAAOpC,EAAAA,EAAAA,KAAiBkC,GAEzBE,EAAKa,aACNb,EAAKa,WAAab,EAAKU,KAAKC,SAAS,IAAIC,SAAS,EAAG,MAGzD,IAAMX,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQjB,OACvCe,EAAI,C,SAEPC,EAAKa,kBAKtB,CACIpB,MAAO,UACPC,MAAO,IACPoB,SAAU,EACVnB,eAAeC,EAAAA,EAAAA,IAAgB,UAAhBA,EAA2B,SAAQ,G,IAALC,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaC,EAAI,KAA5BF,YAAWC,aAC9CE,EAAOpC,EAAAA,EAAAA,KAAiBkC,GAEzBE,EAAKe,gBACNf,EAAKe,eAAgBC,EAAAA,EAAAA,IAAOhB,EAAKiB,QAAQC,SAAS,EAAG,OAGzD,IAAMjB,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQjB,OACvCe,EAAI,C,SAEPC,EAAKe,sBAOpBI,GAASvB,EAAAA,EAAAA,IAAgB,SAAhBA,EAA0B,SACpC,G,IAADC,EAAS,EAATA,UACAuB,EAAW,EAAXA,YACGrB,EAAI,KAFPF,YACAuB,gBAGMnB,EAAU5B,IAEhB,OAAM,SACD6B,MAAG,GAACL,WAAWM,EAAAA,EAAAA,GAAaN,EAAWI,EAAQvB,SAAaqB,EAAI,C,SAC5DP,EAAQ4B,GAAa3B,YAK5B4B,GAAMC,EAAAA,EAAAA,KAAS,SAAa,G,IAC9BzB,EAD8B,EAC9BA,UACAC,EAF8B,EAE9BA,SACGC,EAAI,EAHuB,EAInB,CAHXF,YACAC,aAGMG,EAAU5B,IAEVkD,GAAcC,EAAAA,EAAAA,KAAe,YAC/BC,EAAAA,EAAAA,IAAY,WACRpE,EAAMC,eAAiBM,EAAAA,EAAAA,KAAiBkC,SAIhD,OAAM,SACDI,MAAG,GACAL,WAAWM,EAAAA,EAAAA,GACPN,EACAI,EAAQpB,IACRxB,EAAMC,iBAAmBM,EAAAA,EAAAA,KAAiBkC,IAAaG,EAAQlB,UAEnEX,QAASmD,GACLxB,OAoChB,WAAeuB,EAAAA,EAAAA,KA/Ba,WACxB,IAAMrB,EAAU5B,IAEhB,OAAM,UACDqD,EAAAA,EAAK,KAAKC,EAAAA,GAAe,CAAEC,OAAQ,G,oBAC/BC,EAAAA,QAAI,C,mBACApC,QAAK,C,SAAC,wC,SAGVqC,EAAAA,GAAU,CAACC,MAAO1E,EAAMQ,mB,SAExBmE,EAAAA,EAAS,CAACnC,UAAWI,EAAQ1B,KAAMA,MAAI,E,mBACnC0D,EAAAA,GAAI,CACDpC,UAAWI,EAAQxB,KACnByD,SAAUtE,EAAAA,EAAAA,KAAAA,OACVuE,UAzOA,GA0OA3C,QAASA,EACT4C,gBAAiBjB,EACjBkB,aAAchB,MAIrBhE,EAAMC,gBAAkBD,EAAMC,eAAe2D,QAAQqB,OAAS,IAAC,SAC3DN,EAAAA,EAAS,CAACnC,UAAWI,EAAQ1B,KAAMA,MAAI,E,mBACnCgE,EAAAA,GAAS,CAAC1C,UAAWI,EAAQV,UAAWiD,KAAMnF,EAAMC,eAAe2D,mB","sources":["webpack://_N_E/?0b91","webpack://_N_E/./src/pages/packet-log.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/packet-log\",\n      function () {\n        return require(\"private-next-pages/packet-log.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/packet-log\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack, StackItem } from \"@fluentui/react\";\nimport { makeStyles, mergeClasses, shorthands } from \"@griffel/react\";\nimport { AdbCommand, decodeUtf8 } from \"@yume-chan/adb\";\nimport { autorun, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { CommandBar, Grid, GridCellProps, GridColumn, GridHeaderProps, GridRowProps, HexViewer, toText } from \"../components\";\nimport { globalState, PacketLogItem } from \"../state\";\nimport { Icons, RouteStackProps, useCallbackRef, withDisplayName } from \"../utils\";\n\nconst ADB_COMMAND_NAME = {\n    [AdbCommand.Auth]: 'AUTH',\n    [AdbCommand.Close]: 'CLSE',\n    [AdbCommand.Connect]: 'CNXN',\n    [AdbCommand.OK]: 'OKAY',\n    [AdbCommand.Open]: 'OPEN',\n    [AdbCommand.Write]: 'WRTE',\n};\n\ninterface Column extends GridColumn {\n    title: string;\n}\n\nconst LINE_HEIGHT = 32;\n\nconst state = new class {\n    get commandBarItems(): ICommandBarItemProps[] {\n        return [\n            {\n                key: 'clear',\n                disabled: !globalState.device,\n                iconProps: { iconName: Icons.Delete },\n                text: 'Clear',\n                onClick: () => globalState.clearLog(),\n            }\n        ];\n    }\n\n    selectedPacket: PacketLogItem | undefined = undefined;\n\n    constructor() {\n        makeAutoObservable(\n            this,\n            {\n                selectedPacket: observable.ref,\n            }\n        );\n\n        autorun(() => {\n            if (globalState.logs.length === 0) {\n                this.selectedPacket = undefined;\n            }\n        });\n    }\n};\n\nconst useClasses = makeStyles({\n    grow: {\n        height: 0,\n    },\n    grid: {\n        height: '100%',\n    },\n    header: {\n        textAlign: 'center',\n        lineHeight: `${LINE_HEIGHT}px`,\n    },\n    row: {\n        '&:hover': {\n            backgroundColor: '#f3f2f1',\n        },\n    },\n    selected: {\n        backgroundColor: '#edebe9',\n    },\n    code: {\n        fontFamily: 'monospace',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        lineHeight: LINE_HEIGHT + 'px',\n        cursor: 'default',\n        ...shorthands.overflow('hidden'),\n    },\n    hexViewer: {\n        ...shorthands.padding('12px'),\n        ...shorthands.borderTop('1px', 'solid', 'rgb(243, 242, 241)'),\n    },\n});\n\nconst columns: Column[] = [\n    {\n        title: 'Direction',\n        width: 100,\n        CellComponent: withDisplayName('Direction')(({ className, rowIndex, ...rest }: GridCellProps) => {\n            const item = globalState.logs[rowIndex];\n\n            const classes = useClasses();\n\n            return (\n                <div\n                    className={mergeClasses(className, classes.code)}\n                    {...rest}\n                >\n                    {item.direction}\n                </div>\n            );\n        }),\n    },\n    {\n        title: 'Command',\n        width: 100,\n        CellComponent: withDisplayName('Command')(({ className, rowIndex, ...rest }: GridCellProps) => {\n            const item = globalState.logs[rowIndex];\n\n            if (!item.commandString) {\n                item.commandString =\n                    ADB_COMMAND_NAME[item.command as AdbCommand] ??\n                    decodeUtf8(new Uint32Array([item.command]));\n            }\n\n            const classes = useClasses();\n\n            return (\n                <div\n                    className={mergeClasses(className, classes.code)}\n                    {...rest}\n                >\n                    {item.commandString}\n                </div>\n            );\n        }),\n    },\n    {\n        title: 'Arg0',\n        width: 100,\n        CellComponent: withDisplayName('Command')(({ className, rowIndex, ...rest }: GridCellProps) => {\n            const item = globalState.logs[rowIndex];\n\n            if (!item.arg0String) {\n                item.arg0String = item.arg0.toString(16).padStart(8, '0');\n            }\n\n            const classes = useClasses();\n\n            return (\n                <div\n                    className={mergeClasses(className, classes.code)}\n                    {...rest}\n                >\n                    {item.arg0String}\n                </div>\n            );\n        }),\n    },\n    {\n        title: 'Arg1',\n        width: 100,\n        CellComponent: withDisplayName('Command')(({ className, rowIndex, ...rest }: GridCellProps) => {\n            const item = globalState.logs[rowIndex];\n\n            if (!item.arg1String) {\n                item.arg1String = item.arg0.toString(16).padStart(8, '0');\n            }\n\n            const classes = useClasses();\n\n            return (\n                <div\n                    className={mergeClasses(className, classes.code)}\n                    {...rest}\n                >\n                    {item.arg1String}\n                </div>\n            );\n        }),\n    },\n    {\n        title: 'Payload',\n        width: 200,\n        flexGrow: 1,\n        CellComponent: withDisplayName('Command')(({ className, rowIndex, ...rest }: GridCellProps) => {\n            const item = globalState.logs[rowIndex];\n\n            if (!item.payloadString) {\n                item.payloadString = toText(item.payload.subarray(0, 100));\n            }\n\n            const classes = useClasses();\n\n            return (\n                <div\n                    className={mergeClasses(className, classes.code)}\n                    {...rest}\n                >\n                    {item.payloadString}\n                </div>\n            );\n        }),\n    },\n];\n\nconst Header = withDisplayName('Header')(({\n    className,\n    columnIndex,\n    ...rest\n}: GridHeaderProps) => {\n    const classes = useClasses();\n\n    return (\n        <div className={mergeClasses(className, classes.header)} {...rest}>\n            {columns[columnIndex].title}\n        </div>\n    );\n});\n\nconst Row = observer(function Row({\n    className,\n    rowIndex,\n    ...rest\n}: GridRowProps) {\n    const classes = useClasses();\n\n    const handleClick = useCallbackRef(() => {\n        runInAction(() => {\n            state.selectedPacket = globalState.logs[rowIndex];\n        });\n    });\n\n    return (\n        <div\n            className={mergeClasses(\n                className,\n                classes.row,\n                state.selectedPacket === globalState.logs[rowIndex] && classes.selected\n            )}\n            onClick={handleClick}\n            {...rest}\n        />\n    );\n});\n\nconst PacketLog: NextPage = () => {\n    const classes = useClasses();\n\n    return (\n        <Stack {...RouteStackProps} tokens={{}}>\n            <Head>\n                <title>Packet Log - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={state.commandBarItems} />\n\n            <StackItem className={classes.grow} grow>\n                <Grid\n                    className={classes.grid}\n                    rowCount={globalState.logs.length}\n                    rowHeight={LINE_HEIGHT}\n                    columns={columns}\n                    HeaderComponent={Header}\n                    RowComponent={Row}\n                />\n            </StackItem>\n\n            {state.selectedPacket && state.selectedPacket.payload.length > 0 && (\n                <StackItem className={classes.grow} grow>\n                    <HexViewer className={classes.hexViewer} data={state.selectedPacket.payload} />\n                </StackItem>\n            )}\n        </Stack>\n    );\n};\n\nexport default observer(PacketLog);\n"],"names":["window","__NEXT_P","push","ADB_COMMAND_NAME","AdbCommand","state","selectedPacket","undefined","makeAutoObservable","this","observable","autorun","globalState","commandBarItems","key","disabled","iconProps","iconName","Icons","text","onClick","useClasses","makeStyles","grow","height","grid","header","textAlign","lineHeight","row","backgroundColor","selected","code","fontFamily","textOverflow","whiteSpace","LINE_HEIGHT","cursor","shorthands","hexViewer","columns","title","width","CellComponent","withDisplayName","className","rowIndex","rest","item","classes","div","mergeClasses","direction","commandString","command","decodeUtf8","Uint32Array","arg0String","arg0","toString","padStart","arg1String","flexGrow","payloadString","toText","payload","subarray","Header","columnIndex","Row","observer","handleClick","useCallbackRef","runInAction","Stack","RouteStackProps","tokens","Head","CommandBar","items","StackItem","Grid","rowCount","rowHeight","HeaderComponent","RowComponent","length","HexViewer","data"],"sourceRoot":""}