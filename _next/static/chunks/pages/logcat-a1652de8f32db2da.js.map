{"version":3,"file":"static/chunks/pages/logcat-a1652de8f32db2da.js","mappings":"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","sources":["webpack://_N_E/?8203","webpack://_N_E/./src/pages/logcat.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/logcat\",\n      function () {\n        return require(\"private-next-pages/logcat.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/logcat\"])\n      });\n    }\n  ","// cspell: ignore logcat\n\nimport { ICommandBarItemProps, Stack, StackItem } from \"@fluentui/react\";\nimport { makeStyles, mergeClasses, shorthands } from \"@griffel/react\";\nimport { AbortController, decodeUtf8, ReadableStream, WritableStream } from '@yume-chan/adb';\nimport { Logcat, LogMessage, LogPriority } from '@yume-chan/android-bin';\nimport { autorun, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { CommandBar, Grid, GridColumn, GridHeaderProps, GridRowProps } from \"../components\";\nimport { globalState } from \"../state\";\nimport { Icons, RouteStackProps, useCallbackRef } from \"../utils\";\n\nconst LINE_HEIGHT = 32;\n\nconst useClasses = makeStyles({\n    grid: {\n        height: '100%',\n        marginLeft: '-16px',\n        marginRight: '-16px',\n    },\n    header: {\n        textAlign: 'center',\n        lineHeight: `${LINE_HEIGHT}px`,\n    },\n    row: {\n        '&:hover': {\n            backgroundColor: '#f3f2f1',\n        },\n    },\n    selected: {\n        backgroundColor: '#edebe9',\n    },\n    code: {\n        fontFamily: 'monospace',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n        lineHeight: LINE_HEIGHT + 'px',\n        cursor: 'default',\n        ...shorthands.overflow('hidden'),\n    },\n});\n\nexport interface Column extends GridColumn {\n    title: string;\n}\n\nexport interface LogRow extends LogMessage {\n    timeString?: string;\n    payloadString?: string;\n}\n\nconst state = makeAutoObservable({\n    logcat: undefined as Logcat | undefined,\n    running: false,\n    list: [] as LogRow[],\n    stream: undefined as ReadableStream<LogMessage> | undefined,\n    stopSignal: undefined as AbortController | undefined,\n    selectedCount: 0,\n    start() {\n        if (this.running) {\n            return;\n        }\n\n        this.running = true;\n        this.stream = this.logcat!.binary();\n        this.stopSignal = new AbortController();\n        this.stream\n            .pipeTo(\n                new WritableStream({\n                    write: (chunk) => {\n                        runInAction(() => {\n                            this.list.push(chunk);\n                        });\n                    },\n                }),\n                { signal: this.stopSignal.signal }\n            )\n            .catch(() => { });\n    },\n    stop() {\n        this.running = false;\n        this.stopSignal!.abort();\n    },\n    clear() {\n        this.list = [];\n        this.selectedCount = 0;\n    },\n    get empty() {\n        return this.list.length === 0;\n    },\n    get commandBar(): ICommandBarItemProps[] {\n        return [\n            this.running ? {\n                key: \"stop\",\n                text: \"Stop\",\n                iconProps: { iconName: Icons.Stop },\n                onClick: () => this.stop(),\n            } : {\n                key: \"start\",\n                text: \"Start\",\n                disabled: this.logcat === undefined,\n                iconProps: { iconName: Icons.Play },\n                onClick: () => this.start(),\n            },\n            {\n                key: 'clear',\n                text: 'Clear',\n                disabled: this.empty,\n                iconProps: { iconName: Icons.Delete },\n                onClick: () => this.clear(),\n            },\n            {\n                key: 'copyAll',\n                text: 'Copy Rows',\n                disabled: this.selectedCount === 0,\n                iconProps: { iconName: Icons.Copy },\n                onClick: () => {\n\n                }\n            },\n            {\n                key: 'copyText',\n                text: 'Copy Messages',\n                disabled: this.selectedCount === 0,\n                iconProps: { iconName: Icons.Copy },\n                onClick: () => {\n\n                }\n            }\n        ];\n    },\n    get columns(): Column[] {\n        return [\n            {\n                width: 200,\n                title: 'Time',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n                    if (!item.timeString) {\n                        item.timeString = new Date(item.second * 1000).toISOString();\n                    }\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.timeString}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 80,\n                title: 'PID',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.pid}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 80,\n                title: 'TID',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.tid}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 100,\n                title: 'Priority',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {LogPriority[item.priority]}\n                        </div>\n                    );\n                }\n            },\n            {\n                width: 300,\n                flexGrow: 1,\n                title: 'Payload',\n                CellComponent: ({ rowIndex, columnIndex, className, ...rest }) => {\n                    const item = this.list[rowIndex];\n                    if (!item.payloadString) {\n                        item.payloadString = decodeUtf8(item.payload);\n                    }\n\n                    const classes = useClasses();\n\n                    return (\n                        <div className={mergeClasses(classes.code, className)} {...rest}>\n                            {item.payloadString}\n                        </div>\n                    );\n                }\n            },\n        ];\n    },\n}, {\n    list: observable.shallow,\n});\n\nconsole.log(state);\n\nautorun(() => {\n    if (globalState.device) {\n        state.logcat = new Logcat(globalState.device);\n    } else {\n        state.logcat = undefined;\n        if (state.running) {\n            state.stop();\n        }\n    }\n});\n\nconst Header = observer(function Header({\n    className,\n    columnIndex,\n    ...rest\n}: GridHeaderProps) {\n    const classes = useClasses();\n\n    return (\n        <div className={mergeClasses(className, classes.header)} {...rest}>\n            {state.columns[columnIndex].title}\n        </div>\n    );\n});\n\nconst Row = observer(function Row({\n    className,\n    rowIndex,\n    ...rest\n}: GridRowProps) {\n    const item = state.list[rowIndex];\n    const classes = useClasses();\n\n    const handleClick = useCallbackRef(() => {\n        runInAction(() => {\n        });\n    });\n\n    return (\n        <div\n            className={mergeClasses(\n                className,\n                classes.row,\n            )}\n            onClick={handleClick}\n            {...rest}\n        />\n    );\n});\n\nconst LogcatPage: NextPage = () => {\n    const classes = useClasses();\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Logcat - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={state.commandBar} />\n\n            <StackItem grow>\n                <Grid\n                    className={classes.grid}\n                    rowCount={state.list.length}\n                    rowHeight={LINE_HEIGHT}\n                    columns={state.columns}\n                    HeaderComponent={Header}\n                    RowComponent={Row}\n                />\n            </StackItem>\n        </Stack>\n    );\n};\n\nexport default observer(LogcatPage);\n"],"names":["window","__NEXT_P","push","useClasses","makeStyles","grid","height","marginLeft","marginRight","header","textAlign","lineHeight","row","backgroundColor","selected","code","fontFamily","textOverflow","whiteSpace","LINE_HEIGHT","cursor","shorthands","state","makeAutoObservable","logcat","undefined","running","list","stream","stopSignal","selectedCount","start","this","binary","AbortController","pipeTo","WritableStream","write","chunk","runInAction","signal","catch","stop","abort","clear","empty","length","commandBar","key","text","iconProps","iconName","Icons","onClick","disabled","columns","width","title","CellComponent","rowIndex","className","columnIndex","rest","item","timeString","Date","second","toISOString","classes","div","mergeClasses","pid","tid","LogPriority","priority","flexGrow","payloadString","decodeUtf8","payload","observable","console","log","autorun","globalState","Logcat","Header","observer","Row","handleClick","useCallbackRef","Stack","RouteStackProps","Head","CommandBar","items","StackItem","grow","Grid","rowCount","rowHeight","HeaderComponent","RowComponent"],"sourceRoot":""}